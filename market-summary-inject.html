<!-- ì‹¤ì‹œê°„ ì‹œí™© ìš”ì•½ ì„¹ì…˜ ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    // ì‹¤ì‹œê°„ ì‹œí™© ìš”ì•½ ìƒì„± ë° ì‚½ì…
    function initMarketSummary() {
        // ì¢…í•© ê²°ë¡  ì„¹ì…˜ ì°¾ê¸°
        const sections = document.querySelectorAll('section');
        let targetSection = null;

        sections.forEach(section => {
            const h3 = section.querySelector('h3');
            if (h3 && h3.textContent.includes('ì¢…í•© ê²°ë¡ ')) {
                targetSection = section;
            }
        });

        if (!targetSection) {
            console.error('âŒ ì¢…í•© ê²°ë¡  ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }

        // ì‹œí™© ìš”ì•½ HTML ìƒì„±
        const summaryHTML = `
        <div id="market-summary-live" style="
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            box-shadow: 0 8px 24px rgba(30, 60, 114, 0.3);
            font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
        ">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap;">
                <h3 style="margin: 0; font-size: 22px; font-weight: 600; letter-spacing: -0.5px;">
                    ğŸ“Š ì‹¤ì‹œê°„ ì¢…í•© ì‹œí™©
                </h3>
                <div id="update-time" style="
                    font-size: 13px;
                    background: rgba(255,255,255,0.2);
                    padding: 6px 12px;
                    border-radius: 6px;
                    font-weight: 500;
                "></div>
            </div>
            <div id="market-summary-content" style="
                background: rgba(255,255,255,0.1);
                padding: 20px;
                border-radius: 12px;
                line-height: 1.9;
                font-size: 16px;
                backdrop-filter: blur(10px);
            ">
                <div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.7);">
                    ì‹œì¥ ë°ì´í„° ë¡œë”© ì¤‘...
                </div>
            </div>
        </div>
    `;

        // ì¢…í•© ê²°ë¡  h3 íƒœê·¸ ë°”ë¡œ ë’¤ì— ì‚½ì…
        const h3 = targetSection.querySelector('h3');
        if (h3) {
            h3.insertAdjacentHTML('afterend', summaryHTML);
            console.log('âœ… ì‹œí™© ìš”ì•½ ì„¹ì…˜ ì‚½ì… ì™„ë£Œ');
        }
    }

    // ì‹œí™© ìš”ì•½ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateMarketSummary() {
        const now = new Date();
        const dateStr = now.toLocaleDateString('ko-KR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            weekday: 'long'
        });
        const timeStr = now.toLocaleTimeString('ko-KR', {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });

        // ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
        const updateTimeEl = document.getElementById('update-time');
        if (updateTimeEl) {
            updateTimeEl.textContent = `${dateStr} ${timeStr}`;
        }

        // ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘
        const getPrice = (id) => {
            const el = document.getElementById(id);
            if (!el) return null;
            const text = el.textContent;
            const match = text.match(/[\d,]+\.[\d]+/);
            return match ? parseFloat(match[0].replace(/,/g, '')) : null;
        };

        const getChange = (id) => {
            const el = document.getElementById(id);
            if (!el) return null;
            const text = el.textContent;
            const match = text.match(/([+-]?[\d.]+)%/);
            return match ? parseFloat(match[1]) : null;
        };

        const kospiChange = getChange('kospi-live');
        const kosdaqChange = getChange('kosdaq-live');
        const kospiPrice = getPrice('kospi-live');
        const kosdaqPrice = getPrice('kosdaq-live');

        // ì‹œí™© ë¶„ì„ ìƒì„±
        let summary = '';

        if (kospiChange === null || kosdaqChange === null) {
            summary = `<strong>í˜„ì¬ ì‹œì :</strong> ${dateStr} ${timeStr}<br><br>â° ì‹œì¥ì´ íœ´ì¥ ì¤‘ì´ê±°ë‚˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ê±°ë˜ ì‹œê°„(09:00-15:30)ì— ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.`;
        } else {
            const avgChange = (kospiChange + kosdaqChange) / 2;
            let marketTrend = '';
            let trendEmoji = '';
            let analysis = '';

            if (avgChange > 1) {
                marketTrend = 'ê°•ì„¸';
                trendEmoji = 'ğŸ“ˆğŸ”¥';
                analysis = `KOSPI ${kospiChange > 0 ? '+' : ''}${kospiChange.toFixed(2)}%, KOSDAQ ${kosdaqChange > 0 ? '+' : ''}${kosdaqChange.toFixed(2)}%ë¡œ íˆ¬ì ì‹¬ë¦¬ê°€ ê°œì„ ë˜ê³  ìˆìŠµë‹ˆë‹¤. ë ˆë²„ë¦¬ì§€ ETFë¥¼ í™œìš©í•œ ê³µê²©ì  í¬ì§€ì…˜ êµ¬ì¶• íƒ€ì´ë°ì´ë©°, ëª©í‘œê°€ ë„ë‹¬ ì‹œ ë¶€ë¶„ ìµì ˆì„ ê¶Œì¥í•©ë‹ˆë‹¤.`;
            } else if (avgChange > 0.3) {
                marketTrend = 'ìƒìŠ¹';
                trendEmoji = 'ğŸ“ˆ';
                analysis = `KOSPI ${kospiChange > 0 ? '+' : ''}${kospiChange.toFixed(2)}%, KOSDAQ ${kosdaqChange > 0 ? '+' : ''}${kosdaqChange.toFixed(2)}%ë¡œ ì™„ë§Œí•œ ìƒìŠ¹ íë¦„ì…ë‹ˆë‹¤. ë ˆë²„ë¦¬ì§€ 50% ë‚´ì™¸ë¡œ ì•ˆì •ì  ì§„ì…ì„ ì¶”ì²œí•˜ë©°, ê¸‰ë“± ì‹œ ì¼ë¶€ ì°¨ìµ ì‹¤í˜„ì„ ê³ ë ¤í•˜ì„¸ìš”.`;
            } else if (avgChange > -0.3) {
                marketTrend = 'í˜¼ì¡°';
                trendEmoji = 'ğŸ“Š';
                analysis = `KOSPI ${kospiChange > 0 ? '+' : ''}${kospiChange.toFixed(2)}%, KOSDAQ ${kosdaqChange > 0 ? '+' : ''}${kosdaqChange.toFixed(2)}%ë¡œ ë°©í–¥ì„±ì´ ë¶ˆë¶„ëª…í•©ë‹ˆë‹¤. í˜„ê¸ˆ ë¹„ì¤‘ì„ ë†’ê²Œ ìœ ì§€í•˜ë©° ì¶”ì„¸ í™•ì¸ í›„ ì§„ì…í•˜ê³ , ë‹¨ê¸° ë³€ë™ì„±ì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.`;
            } else if (avgChange > -1) {
                marketTrend = 'ì•½ì„¸';
                trendEmoji = 'ğŸ“‰';
                analysis = `KOSPI ${kospiChange.toFixed(2)}%, KOSDAQ ${kosdaqChange.toFixed(2)}%ë¡œ ì¡°ì • êµ­ë©´ì…ë‹ˆë‹¤. ë ˆë²„ë¦¬ì§€ ë¹„ì¤‘ì„ 30% ì´í•˜ë¡œ ì¶•ì†Œí•˜ê³ , ì†ì ˆ ê¸°ì¤€ì„ ì—„ê²©íˆ ì¤€ìˆ˜í•˜ë©° ë°©ì–´ì  í¬ì§€ì…˜ì„ ìœ ì§€í•˜ì„¸ìš”.`;
            } else {
                marketTrend = 'ê¸‰ë½';
                trendEmoji = 'âš ï¸ğŸ“‰';
                analysis = `KOSPI ${kospiChange.toFixed(2)}%, KOSDAQ ${kosdaqChange.toFixed(2)}%ë¡œ ê¸‰ê²©í•œ í•˜ë½ì„¸ì…ë‹ˆë‹¤. ë ˆë²„ë¦¬ì§€ í¬ì§€ì…˜ ì¦‰ì‹œ ì²­ì‚°ì„ ê³ ë ¤í•˜ê³ , í˜„ê¸ˆ ë¹„ì¤‘ 80% ì´ìƒ í™•ë³´í•˜ë©° ë°˜ë“± ì‹œì ê¹Œì§€ ê´€ë§ì„ ê¶Œì¥í•©ë‹ˆë‹¤.`;
            }

            summary = `
            <div style="margin-bottom: 16px;">
                <strong style="font-size: 18px;">${trendEmoji} í˜„ì¬ ì‹œì¥: ${marketTrend}</strong>
                <div style="margin-top: 8px; font-size: 14px; color: rgba(255,255,255,0.8);">
                    ${dateStr} ${timeStr} ê¸°ì¤€
                </div>
            </div>
            <div style="line-height: 1.9;">
                ${analysis}
            </div>
        `;
        }

        const summaryEl = document.getElementById('market-summary-content');
        if (summaryEl) {
            summaryEl.innerHTML = summary;
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    window.addEventListener('DOMContentLoaded', () => {
        // ì‹œí™© ì„¹ì…˜ ìƒì„±
        initMarketSummary();

        // ì´ˆê¸° ì—…ë°ì´íŠ¸ (2ì´ˆ í›„)
        setTimeout(updateMarketSummary, 2000);

        // 30ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸
        setInterval(updateMarketSummary, 30000);

        console.log('âœ… ì‹¤ì‹œê°„ ì‹œí™© ìš”ì•½ ì‹œìŠ¤í…œ í™œì„±í™”');
    });
</script>